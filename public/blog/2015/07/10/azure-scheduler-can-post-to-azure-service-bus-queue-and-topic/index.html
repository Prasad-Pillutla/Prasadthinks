
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Azure Scheduler can post to Azure Service Bus Queue and Topic - Prasad Thinks</title>
  <meta name="author" content="Prasad">

  
  <meta name="description" content="">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://prasad-pillutla.github.io/Prasadthinks/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/PrasadThinks" rel="alternate" title="Prasad Thinks" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-62377917-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Prasad Thinks</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/Portfolio">Portfolio</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="http://feeds.feedburner.com/PrasadThinks" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="https://www.google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:prasad-pillutla.github.io/Prasadthinks" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Azure Scheduler Can Post to Azure Service Bus Queue and Topic</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-10T18:53:09+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:53 pm</span></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Azure Scheduler today doesn’t allow submitting long running jobs to Service bus queues/topics but does allow submitting them to storage queues. What if, there is a requirement to submit jobs to service bus queues/topics so that features like duplicate detection can be leveraged to eliminate duplicate jobs from getting executed. One can submit messages to Service bus queue from Scheduler dashboard using REST APIs. Here is how we do it</p>

<p><img src="/images/SB.jpg" alt="Job Action" /></p>

<p>Select <strong>Post</strong> method in Scheduler Job dashboard, which displays above template. URI will represent Queue or Topic where ever we want to send message. URI template for Service bus would be <em>http{s}://{serviceNamespace}.servicebus.windows.net/{queuePath|topicPath}/messages</em></p>

<p>we can add timeout for POST request by appending timeout at the end of Uri. POST Uri with timeout will be <em>http{s}://{serviceNamespace}.servicebus.windows.net/{queuePath|topicPath}/messages?timeout=</em></p>

<p><strong>example</strong>: <em>http{s}://{serviceNamespace}.servicebus.windows.net/{queuePath|topicPath}/messages?timeout=60</em></p>

<p><strong>BrokerProperties</strong> allows one to set properties like TimeToLive, MessageId, Label etc… These properties have to beaded in Json format and this is mandatory</p>

<p><strong>Authorization</strong> property is used to define AccessToken.</p>

<p><strong>Content-Type</strong> value can be anything but it is mandatory to have this parameter added to header.</p>

<p>When Scheduler executes the job, a message will be posted to Service Bus Queue or Topic. In Service Bus Explorer screen snapshot below, we can see properties that we set while creating the job
<img src="/images/SBExp.jpg" alt="Service Bus Explorer" /></p>

<p>You can do this from code as well and below is the sample</p>

<pre><code>    using System;
    using Microsoft.WindowsAzure.Scheduler;
    using Microsoft.Azure;
    using Microsoft.WindowsAzure.Scheduler.Models;
    using Microsoft.WindowsAzure.Management.Scheduler;

    namespace SchedulerFault
    {
        public class Scheduler
        {
            private SchedulerClient SchdClient;
            SubscriptionCloudCredentials credentials;
            public Scheduler(SubscriptionCloudCredentials creds)
            {
                credentials = creds;
                SchdClient = new SchedulerClient("&lt;Scheduler Service&gt;", "Job Collection Name", credentials);                
            }

            public void inject()
            {
                var Request = new JobHttpRequest(new Uri(@"&lt;Topic/Queue URI&gt;?timeout=60"), "POST");
                Request.Body = "Test Newton Properties";
                Request.Headers.Add("BrokerProperties", "{\"Label\":\"M2\", \"MessageId\":\"Id1\"}");
                Request.Headers.Add("Content-Type","application/xml");
                Request.Headers.Add("Authorization", "&lt;Access Token&gt;");

                var StartTime = DateTime.Now;
                var Recurrence = new JobRecurrence()
                {
                    Frequency = JobRecurrenceFrequency.Minute,
                    Interval = 1,
                    Count = 5
                };
                var Action = new JobAction();
                Action.Type = JobActionType.Http;
                Action.Request = Request;
                var jobParam = new JobCreateParameters();
                jobParam.Action = Action;
                jobParam.Recurrence = Recurrence;
                jobParam.StartTime = StartTime;

                try
                {
                    var Response = SchdClient.Jobs.Create(jobParam);
                    Console.WriteLine(Response.RequestId);
                    Console.WriteLine(Response.StatusCode);
                    Console.WriteLine(Response.Job.Id);
                }
                catch(Exception ex)
                {
                    Console.WriteLine(ex.Message);            
                }            
            }
        }
    }
</code></pre>

<p>We need to install Microsoft WindowsAzure Management Scheduler Nuget package has necessary SDK for managing Scheduler and jobs in it.</p>

<p>Scheduler service name(first parameter for SchedulerClient constructor) can be obtained from Scheduler dashboard or it follows following format <strong>CS-RegionName-scheduler</strong>. If scheduler is created int Southeast Asia then Service name will be <strong>CS-SoutheastAsia-scheduler</strong>. If it is created in SouthCentralUS then service name will be <strong>CS-SouthCentralUS-scheduler</strong>.</p>

<p>Job Collection name(second parameter for SchedulerClient constructor) is a container in which Job will be created.</p>

<p>Simple aah, If anyone says to you that Azure Scheduler cannot submit messages to Service Bus topic or queue then you know what to say and where to re-direct them.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Prasad</span></span>

      




<time class='entry-date' datetime='2015-07-10T18:53:09+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:53 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/azure/'>azure,</a>, <a class='category' href='/blog/categories/bus/'>bus,</a>, <a class='category' href='/blog/categories/queues/'>queues</a>, <a class='category' href='/blog/categories/scheduler/'>scheduler,</a>, <a class='category' href='/blog/categories/service/'>service</a>, <a class='category' href='/blog/categories/topic/'>topic,</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://prasad-pillutla.github.io/Prasadthinks/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic/" data-via="prasad_pillu" data-counturl="http://prasad-pillutla.github.io/Prasadthinks/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2015/07/02/azure-service-bus-partition-queues-and-topics-are-they-different/" title="Previous Post:
        Azure Service Bus Partition Queues and Topics? Are they different?">&laquo; Azure Service Bus Partition Queues and Topics? Are they different?</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/2015/08/04/parallelism-on-multi-core-processors/"
        title="Next Post: Parallelism on Multi-core Processors">Parallelism on Multi-core Processors
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2016/09/08/chatbots-integrating-with-your-chat-client/">Chatbots - Integrating with your chat client</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/27/architect-attitude-architecture/">Architect Attitude Architecture</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/10/parallelism-on-multi-core-processors-continuation/">Parallelism on Multi-core Processors: Continuation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/04/parallelism-on-multi-core-processors/">Parallelism on Multi-core Processors</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic/">Azure Scheduler can post to Azure Service Bus Queue and Topic</a>
      </li>
    
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub Repos</li>
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Prasad-Pillutla">@Prasad-Pillutla</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'Prasad-Pillutla',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/prasadpillutla?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/prasadpillutla">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2016 - Prasad -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'PrasadPillutla';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://prasad-pillutla.github.io/Prasadthinks/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic/';
        var disqus_url = 'http://prasad-pillutla.github.io/Prasadthinks/blog/2015/07/10/azure-scheduler-can-post-to-azure-service-bus-queue-and-topic/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
